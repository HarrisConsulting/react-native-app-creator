# React Native New Project Script Generator

**Auto-generates a new React Native project with all Metro error prevention
built-in**

## Usage

Save this as `create-rn-project.sh` and run:

```bash
./create-rn-project.sh YourProjectName
```

## Script Contents

```bash
#!/bin/bash

# React Native Project Creator with Metro Error Prevention
# Based on ReactNativeTest lessons learned - August 4, 2025

PROJECT_NAME="$1"

if [ -z "$PROJECT_NAME" ]; then
    echo "âŒ Usage: $0 <ProjectName>"
    echo "ğŸ“ Example: $0 MyAwesomeApp"
    exit 1
fi

PROJECTS_DIR="/Users/rogerharris/Projects"
PROJECT_PATH="$PROJECTS_DIR/$PROJECT_NAME"

echo "ğŸš€ Creating React Native project with Metro error prevention..."
echo "ğŸ“ Project: $PROJECT_NAME"
echo "ğŸ“ Location: $PROJECT_PATH"

# Phase 1: Create project
echo "ğŸ“¦ Phase 1: Creating React Native project..."
cd "$PROJECTS_DIR" || exit 1
npx @react-native-community/cli@latest init "$PROJECT_NAME" --skip-install

# Phase 2: Navigate to project
echo "ğŸ“‚ Phase 2: Entering project directory..."
cd "$PROJECT_PATH" || exit 1
pwd

# Phase 3: Create Metro safety script
echo "ğŸ›¡ï¸ Phase 3: Creating Metro safety script..."
cat > start-metro.sh << EOF
#!/bin/bash

# Metro Start Protocol for $PROJECT_NAME
# Auto-generated by create-rn-project.sh

PROJECT_DIR="$PROJECT_PATH"

echo "ğŸš€ Starting Metro from correct project directory..."
echo "ğŸ“ Project Directory: \$PROJECT_DIR"

# Change to project directory
cd "\$PROJECT_DIR" || exit 1

# Verify we're in the right place
echo "ğŸ“ Current Directory: \$(pwd)"
echo "âœ… Verifying index.js exists: \$(ls -la index.js 2>/dev/null || echo 'NOT FOUND')"

# Kill any existing Metro processes
echo "ğŸ”„ Stopping any existing Metro processes..."
pkill -f metro 2>/dev/null || true

# Start Metro with cache reset
echo "â–¶ï¸ Starting Metro with cache reset..."
npm start -- --reset-cache
EOF

chmod +x start-metro.sh
echo "âœ… Metro safety script created and made executable"

# Phase 4: Add safety scripts to package.json
echo "ğŸ”§ Phase 4: Adding safety scripts to package.json..."
npm pkg set scripts.start-safe="./start-metro.sh"
npm pkg set scripts.verify-project="pwd && ls -la index.js package.json ios/"
npm pkg set scripts.test-bundle="curl -s 'http://localhost:8081/index.bundle?platform=ios' | head -2"
npm pkg set scripts.clean-start="pkill -f metro || true && ./start-metro.sh"
npm pkg set scripts.ios-safe="npm run verify-project && npx react-native run-ios"
echo "âœ… Safety scripts added to package.json"

# Phase 5: Create protocol documentation
echo "ğŸ“‹ Phase 5: Creating protocol documentation..."
cat > METRO_PROTOCOL.md << EOF
# Metro Start Protocol for $PROJECT_NAME

## âš ï¸ CRITICAL: Always follow this sequence

1. **Verify Directory**: \`npm run verify-project\`
2. **Start Metro Safely**: \`npm run start-safe\`
3. **Test Bundle**: \`npm run test-bundle\`
4. **Launch App**: \`npm run ios-safe\`

## ğŸš¨ If You See Errors

- Red error screen â†’ Metro directory issue
- White screen â†’ Bundle not loading
- "No script URL" â†’ Metro not running from correct directory

**Solution**: \`npm run clean-start\` then \`npm run ios-safe\`

## Bundle Test Success
When you run \`npm run test-bundle\`, you should see:
\`\`\`
var __BUNDLE_START_TIME__=globalThis.nativePerformanceNow?...
\`\`\`

If you see error messages, Metro is not running from correct directory.

## Emergency Protocol
\`\`\`bash
pkill -f metro
cd $PROJECT_PATH
./start-metro.sh
npm run test-bundle  # Must pass before proceeding
npm run ios-safe
\`\`\`

Created: $(date)
Based on: ReactNativeTest lessons learned
EOF
echo "âœ… Protocol documentation created"

# Phase 6: Create VS Code tasks
echo "ğŸ”§ Phase 6: Creating VS Code tasks..."
mkdir -p .vscode
cat > .vscode/tasks.json << EOF
{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "Start Metro Safely",
            "type": "shell",
            "command": "./start-metro.sh",
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "new"
            },
            "problemMatcher": []
        },
        {
            "label": "Verify Project Directory",
            "type": "shell",
            "command": "npm run verify-project",
            "group": "test"
        },
        {
            "label": "Test Metro Bundle",
            "type": "shell",
            "command": "npm run test-bundle",
            "group": "test"
        },
        {
            "label": "Clean Start Metro",
            "type": "shell",
            "command": "npm run clean-start",
            "group": "build"
        }
    ]
}
EOF
echo "âœ… VS Code tasks configured"

# Phase 7: Install dependencies
echo "ğŸ“¦ Phase 7: Installing dependencies..."
npm install
echo "âœ… npm dependencies installed"

echo "ğŸ“± Phase 8: Installing iOS dependencies..."
cd ios && pod install && cd ..
echo "âœ… CocoaPods dependencies installed"

# Phase 8: Create docs directory and success log
echo "ğŸ“š Phase 9: Creating documentation structure..."
mkdir -p docs
echo "âœ… $(date): $PROJECT_NAME successfully created with Metro error prevention" > docs/creation-success.log

# Phase 9: Final verification
echo "ğŸ” Phase 10: Final verification..."
echo "ğŸ“ Current directory: $(pwd)"
echo "ğŸ“‹ Project structure:"
ls -la start-metro.sh METRO_PROTOCOL.md package.json index.js
echo ""

# Summary
echo "ğŸ‰ SUCCESS! React Native project '$PROJECT_NAME' created with Metro error prevention"
echo ""
echo "ğŸ“‹ Next Steps:"
echo "1. npm run verify-project   # Verify you're in correct directory"
echo "2. npm run start-safe       # Start Metro safely"
echo "3. npm run test-bundle      # Test bundle (should return JavaScript)"
echo "4. npm run ios-safe         # Launch app (in new terminal)"
echo ""
echo "ğŸ“š Documentation:"
echo "- METRO_PROTOCOL.md         # Protocol instructions"
echo "- start-metro.sh            # Metro safety script"
echo "- .vscode/tasks.json        # VS Code integration"
echo ""
echo "ğŸš¨ Remember: ALWAYS run 'npm run test-bundle' and verify it returns"
echo "   JavaScript before launching the app. This prevents Metro directory errors."
echo ""
echo "âœ… Project ready for development!"
```

## Installation Instructions

1. **Save the script**:

```bash
curl -o create-rn-project.sh https://your-url/create-rn-project.sh
chmod +x create-rn-project.sh
```

2. **Use the script**:

```bash
./create-rn-project.sh MyNewProject
```

3. **Follow the output instructions** for first build verification

## What This Script Prevents

- âŒ Metro directory resolution errors
- âŒ "Unable to resolve module ./index" errors
- âŒ "No script URL provided" errors
- âŒ Red error screens on first launch
- âŒ Hours of circular debugging

## What This Script Creates

- âœ… React Native project with error prevention built-in
- âœ… Metro safety script that forces correct directory
- âœ… Package.json with safety commands
- âœ… Protocol documentation
- âœ… VS Code task integration
- âœ… Automated dependency installation
- âœ… Success verification and logging

Based on the hard-learned lessons from ReactNativeTest debugging on August
4, 2025.
